# skill-dev-proxy
Проскирующий навык для Алисы и Сбера, позволяющий отлаживать другие навыки.

## Установка
1. `skill-dev-proxy` удобнее всего запустить на [heroku](https://heroku.com) в бесплатном аккаунте. Для этого нажмите на кнопку ниже и следуйте инструкциям:

   [![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

2. Вы интерфейсе управления приложением на heroku вы увидите переменную окружения `TARGETS` - добавьте туда свои навыки в виде JSON, например:
   ```json
   [
    {
      "name": "Локалхост",
      "regexp": "(local|локал|около)\\s?([hfp]ost|[хп]ост)",
      "url": "websocket"
    },
    {
      "name": "Мой навык 1",
      "url": "https://my-webhook.ru"
    }
   ]
   ```

3. Подключите навык к Алисе. В [панели разработчика](https://dialogs.yandex.ru/developer) создайте приватный навык и укажите ему вебхуком ссылку на приложение, вида `xxx`.

## Использование
Доступные команды в проксирующем навыке:
- `"список таргетов"` - просмотр списка таргетов для проксирования
- `"установи таргет ХХХ"` - установка таргета для проксирования (`XXX` - имя навыка)
- все остальные команды проксируются в выбранный таргет

## Проксирование на localhost
Для отладки локального кода удобно проксировать запросы на localhost.
Для этого используется облачный message broker https://cloudamqp.com.
Там в бесплатном тарифе 1 000 000 сообщений в месяц, что более чем достаточно.

1. Зарегистрируйтесь на https://cloudamqp.com, создайте инстанс RabbitMQ и получите урл вида `amqps://...`
2. Добавьте этот урл в `TARGETS` как в примере выше
3. В своем проекте установите зависимость `skill-dev-proxy`
  ```
  npm i -D skill-dev-proxy
  ```
4. Заведите в проекте скрипт, который слушает AMQP и вызывает ваш код. Пример:
  ```js
  // check.js
  const { waitMessages } = require('skill-dev-proxy');
  const { handler } = require('./skill');

  waitMessages({
    amqpUrl: 'amqps://....',
    handler,
  });
  ```
5. Запустите это скрипт `node check.js`
6. В проксирующем навыке скажите `Установи таргет локалхост`
7. Теперь все запросы в проксирующий навык будут обрабатываться локальным кодом в `./skill`

