# skill-dev-proxy
Проскирующий навык для Алисы и Сбера, позволяющий отлаживать другие навыки.

## Установка
1. `skill-dev-proxy` удобнее всего развернуть на [heroku](https://heroku.com) в бесплатном аккаунте. Для этого нажмите на кнопку ниже:

   [![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

2. Укажите название приложения, регион `Europe` и нажмите `Deploy app`
3. После успешного деплоя нажмите на кнопку `View app`. Откроется новая вкладка по урлу `https://xxx.herokuapp.com`. Там будет текст:
   ```
   Работает. Таргеты:
   Локалхост
   Мой навык 1
   ```
4. В настройках приложения вы увидите переменную окружения `TARGETS`. Это список навыков для проксирования. Внесите туда свои навыки в виде JSON, например:
   ```json
   [
    {
      "name": "Локалхост",
      "regexp": "(local|локал|около)\\s?([hfp]ost|[хп]ост)",
      "url": "websocket"
    },
    {
      "name": "Мой навык 1",
      "url": "https://my-webhook.ru"
    }
   ]
   ```

5. Подключите `skill-dev-proxy` к Алисе. В [панели разработчика](https://dialogs.yandex.ru/developer) создайте приватный навык и укажите ему вебхуком ссылку на приложение, вида `https://xxx.herokuapp.com`.

## Использование
1. Запустите ваш приватный навык на устройстве
2. Скажите `список таргетов`
3. Нажмите на таргет для проксирования
4. Все последующие фразы проксируются в выбранный таргет
5. Для смены таргета в любой момент скажите `список таргетов` или `установи таргет XXX`

## Проксирование на localhost
Для отладки локального кода есть таргет `Локалхост`, который проксирует запросы через WebSocket. Как подключить к проекту на Node.js:

1. Установите в проект зависимость `skill-dev-proxy`
  ```
  npm i -D skill-dev-proxy
  ```
2. Заведите в проекте скрипт, который будет слушаеть запросы и вызывать ваш код. Пример:
  ```js
  // check.js
  const { runClient } = require('skill-dev-proxy');
  const { handler } = require('./skill');

  runClient({
    wsUrl: 'https://xxx.herokuapp.com', // <-- замените на ваш урл на хероку
    handler, // <-- js-функция или урл вида http://localhost:PORT
  });
  ```
3. Запустите это скрипт `node check.js`
4. В проксирующем навыке скажите `Установи таргет локалхост`
5. Теперь все запросы в проксирующий навык будут обрабатываться локальным кодом в `./skill`

