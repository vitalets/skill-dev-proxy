# skill-dev-proxy
Навык для Алисы, позволяющий отлаживать другие навыки прямо на устройстве.

## Установка
Навык устанавливается в виде облачной функции на я.облаке.

1. Создайте новую облачную функцию в [я.облаке](https://console.cloud.yandex.ru) с типом `nodejs14`
2. Создайте в корне файл `index.js` и cкопируйте в него содержимое `dist/index.js`
3. Создайте в корне файл `package.json` и cкопируйте в него содержимое `dist/package.json`
4. Создайте в корне файл `targets.js`, cкопируйте в него содержимое `dist/targets.js` и **внесите туда свои таргеты для проксирования**
5. Установите параметры функции:
  - точка входа `index.handler`
  - таймаут `3`
  - память `128`
6. Нажмите "создать версию"
7. Подключение к **Алисе**: в панели разработчика навыков заведите навык и укажите ему вебхуком созданную функцию.

## Использование
Доступные команды в навыке:
- `"список таргетов"` - просмотр списка таргетов для проксирования
- `"установи таргет ХХХ"` - установка таргета для проксирования
- все остальные команды проксируются в выбранный таргет

## Проксирование на localhost
Для отладки локально запущенных навыков удобно проксировать запросы на localhost.
Для этого используется облачный message broker https://cloudamqp.com.
Там в бесплатном тарифе 1 000 000 сообщений в месяц, что более чем достаточно.

1. Зарегистрируйтесь на https://cloudamqp.com, создайте инстанс RabbitMQ и получите урл вида `amqps://...`
2. Внесите этот урл в `targets.js`
3. Скопируйте скрипт `examples/localhost/check-on-device.js` в проект с навыком, который хотите тестировать. В скрипт также прокиньте переменную окружения `AMQP_URL=amqps://` и укажите путь к коду навыка
4. Запустите скрипт `node check-on-device.js`

Как альтернатива - можно использовать [ngrok](https://ngrok.com/). Но это менее удобно, т.к. придется каждый раз менять урл в `targets.js`.


